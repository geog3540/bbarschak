"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1861],{61870:function(e,t,n){n.d(t,{CU:function(){return c},Kj:function(){return v},au:function(){return d},dY:function(){return y},gg:function(){return b},iQ:function(){return a},kO:function(){return h},qc:function(){return g},r2:function(){return p},rw:function(){return m}});var s=n(41799),i=n(52054),o=n(602),l=n(27193),u=n(3142);const a=()=>({isPublishing:!0});function r(e,t){e({type:"showErrorToast",message:t,key:"publish"}),e({type:"publishFailed"})}const c=async(e,t,n)=>{let{notebook:s}=e,{unlisted:i,customSlug:a,customThumbnail:c,live:d}=t;if(s.isPublishing)return;const{id:h,slug:p,thumbnail:b}=s,g=(0,l.Ui)("model"in s?s.model:"title"in s?s:null);if(void 0!==a&&p!==a){n({type:"showProcessingToast",key:"publish",message:"Setting slug for ".concat(g,"\u2026")});try{await(0,o.Fv)("/document/".concat(h,"/slug"),{slug:a||null})}catch(v){return void(v.errors&&v.errors.length>0&&"SLUG_INVALID"===(null===v||void 0===v?void 0:v.errors[0].code)?r(n,"Setting notebook URL failed: URL invalid."):r(n,"Oops, setting notebook URL failed. Try again?"))}}let m=b;if(void 0!==c&&(c||b!==s.defaultThumbnail)&&c!==b){n({type:"showProcessingToast",key:"publish",message:"Setting thumbnail for ".concat(g,"\u2026")});try{m=await(0,o.Fv)("/document/".concat(h,"/thumbnail"),{thumbnail:c||null})||s.defaultThumbnail}catch(f){return void r(n,"Oops, setting notebook thumbnail failed. Try again?")}}const y={version:s.saveVersion,title:g,unlisted:i,live:d};try{n({type:"showProcessingToast",key:"publish",message:d?"Making ".concat(g," public\u2026"):"Publishing ".concat(g,"\u2026")});const{slug:e,update_time:t,access_level:l}=await(0,o.Fv)("/document/".concat(h,"/publish"),y);n({type:"showSuccessToast",message:d?"".concat(g," made public"):i?(0,u.cg)(s)?"Republished '".concat(g,"' (unlisted)"):"Published '".concat(g,"' (unlisted)"):(0,u.s9)(s)?"Republished '".concat(g,"'"):"Published '".concat(g,"'"),key:"publish"}),n({type:"publishSucceeded",publishVersion:s.saveVersion,updateTime:t,publishLevel:l,slug:e,thumbnail:m}),n({type:"updatedNotebook"})}catch(k){r(n,i?"Oops, unlisted publishing failed. Try again?":"Oops, publishing failed. Try again?")}},d=(e,t)=>{let{publishVersion:n,updateTime:o,slug:l,thumbnail:a,publishLevel:r}=t;const{publishTime:c,roles:d}=e,h="live"===r&&"editorStates"in e&&(0,u.os)(e)?(0,i.qk)(e,!1):null,p="live"===r?d.filter((e=>"readonly"!==e)):d;return(0,s.Z)({publishLevel:r,publishVersion:n,publishTime:c||o,editUnpublished:!1,thumbnail:a,slug:l,isPublishing:!1,roles:p},h)},h=async(e,t,n)=>{let{notebook:s}=e,{unlisted:i}=t;if(s.isPublishing)return;const u=(0,l.Ui)("model"in s?s.model:"title"in s?s:null),a={version:s.saveVersion,live:!0,unlisted:i};try{let e=s.publishLevel;e!==(i?"live_unlisted":"live")&&(n({type:"showProcessingToast",key:"publish",message:"Making ".concat(u," public").concat(i?" (unlisted)":"","\u2026")}),({access_level:e}=await(0,o.Fv)("/document/".concat(s.id,"/publish"),a)),n({type:"showSuccessToast",message:"".concat(u," made public").concat(i?" (unlisted)":""),key:"publish"})),n({type:"publishLiveSucceeded",publishLevel:e}),n({type:"updatedNotebook"})}catch(c){r(n,"Oops, making public failed. Try again?")}},p=(e,t)=>{let{publishLevel:n}=t;const{roles:o}=e,l="live"===n&&"editorStates"in e&&(0,u.os)(e)?(0,i.qk)(e,!1):null,a="live"===n?o.filter((e=>"readonly"!==e)):o;return(0,s.Z)({publishLevel:n,editUnpublished:!1,isPublishing:!1,roles:a},l)},b=()=>({isPublishing:!1}),g=()=>({isUnpublishing:!0}),m=async(e,t,n)=>{let{notebook:s}=e;if(s.isUnpublishing)return;const i=(0,l.Ui)("model"in s?s.model:"title"in s?s:null),u="live"===s.publishLevel||"live_unlisted"===s.publishLevel;try{n({type:"showProcessingToast",key:"unpublish",message:u?"Removing public access to ".concat(i,"\u2026"):"Unpublishing ".concat(i,"\u2026")});const e=await(0,o.Fv)("/document/".concat(s.id,"/unpublish"),void 0);n({type:"showSuccessToast",message:u?"Removed public access to ".concat(i):"Unpublished '".concat(i,"'"),key:"unpublish"}),n({type:"unpublishSucceeded",slug:e.slug||null})}catch(a){n({type:"showErrorToast",message:u?"Oops, removing public access failed. Try again?":"Oops, unpublishing failed. Try again?",key:"unpublish"}),n({type:"unpublishFailed"})}},y=(e,t)=>{let{slug:n}=t;return{publishLevel:"private",publishVersion:null,publishTime:null,editUnpublished:!1,slug:n,isUnpublishing:!1,pausedVersion:null}},v=()=>({isUnpublishing:!1})},6826:function(e,t,n){n.d(t,{B:function(){return u},b:function(){return a}});var s=n(602),i=n(19671),o=n(90627);function l(e){const t=new Set(e.map((e=>e.login)));return e=>!t.has(e.login)}const u=async(e,t,n)=>{let{notebook:u,currentUser:a}=e;const{currentMembers:r,newMembers:c,newRoles:d,message:h}=t,{id:p}=u,b=e=>"invited"===e.status,g=e=>"member"===e.status,m=function(e){const t=new Map(e.map((e=>[e.login,e])));return e=>t.has(e.login)&&t.get(e.login).role!==e.role}(r),y=l(c),v=l(r),f=c.filter(g).filter(v),k=c.filter(g).filter(m),T=r.filter(g).filter(y),S=c.filter(b).filter(v).map((e=>({email:e.login,role:e.role}))),w=r.filter(b).filter(y).map((e=>({email:e.login}))),U=c.some((e=>"team"===e.type))?"team":c.length>1||c.some((e=>"group"===e.type))?"shared":"private";try{await(0,s.Fv)("/document/".concat(p,"/roles"),{roles:[...f,...k].map((e=>{let{id:t,role:n}=e;return{user_id:t,role:n}})).concat(T.map((e=>{let{id:t}=e;return{user_id:t,role:null}}))),invitations:S.map((e=>({email:e.email,role:e.role}))).concat(w.map((e=>({email:e.email,role:null})))),message:h})}catch(N){return void(0,o.S)({key:"setRoles",error:N,dispatch:n,message:"Unable to set roles"})}for(const{id:s,role:o,team_role:l,type:F}of f){var R;(0,i.MR)((0,i.ym)({type:"notebook:manage:changeRole",notebook:u,currentUser:a,data:{prevRole:(null===(R=r.find((e=>e.id===s)))||void 0===R?void 0:R.role)||null,newRole:o,userId:s,userType:F,memberId:l?s:void 0,memberRole:null!==l&&void 0!==l?l:void 0},eventVersion:5})),ga("send","event","Notebook","Change role"),gtag("event","Change role",{event_category:"Notebook"})}for(const{id:s,team_role:o,type:l}of T){var L;(0,i.MR)((0,i.ym)({type:"notebook:manage:changeRole",notebook:u,currentUser:a,data:{prevRole:(null===(L=T.find((e=>e.id===s)))||void 0===L?void 0:L.role)||null,newRole:null,userId:s,userType:l,memberId:o?s:void 0,memberRole:null!==o&&void 0!==o?o:void 0},eventVersion:5})),ga("send","event","Notebook","Change role"),gtag("event","Change role",{event_category:"Notebook"})}n({type:"shareSucceeded",newSharing:U,newRoles:d}),n({type:"updatedNotebook"})},a=(e,t)=>{let{newSharing:n,newRoles:s}=t;if(0!==s.length)return{sharing:n,roles:s};location.replace("/")}},41894:function(e,t,n){n.d(t,{g:function(){return o},m:function(){return i}});var s=n(602);const i=async(e,t,n)=>{let i,{slug:o}=t;const{notebook:{id:l}}=e;try{i=await(0,s.Fv)("/document/".concat(l,"/slug"),{slug:o})}catch(u){return void(u.errors&&u.errors.length>0&&"SLUG_INVALID"===u.errors[0].code?n({type:"showErrorToast",message:"Setting notebook URL failed: URL invalid.",key:"setSlug"}):n({type:"showErrorToast",message:"Oops, setting notebook URL failed. Try again?",key:"setSlug"}))}n({type:"setSlugSucceeded",slug:i.slug}),n({type:"updatedNotebook"})},o=(e,t)=>{let{slug:n}=t;return{slug:n}}},16504:function(e,t,n){n.d(t,{QJ:function(){return r},fv:function(){return u},pT:function(){return a},zu:function(){return c}});var s=n(85893),i=n(39736),o=n(602),l=n(36448);const u=async(e,t,n)=>{let{notebook:{id:l}}=e,{trashed:u,relocate:a=!0}=t;const r={trashed:u};try{await(0,o.Fv)("/document/".concat(l,"/trash"),r),n({type:"trashSucceeded",trashed:u,relocate:a}),a||(n({type:"showSuccessToast",message:u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center",children:[i.MI,"Moved to trash"]}),(0,s.jsx)("button",{onClick:()=>{n({type:"trashRequested",trashed:!1,relocate:a})},className:"pa0 fw6 no-underline gray hover-dark-gray bg-transparent bn pointer",children:"Undo"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center",children:[i.MI,"Moved out of trash"]}),(0,s.jsx)("button",{onClick:()=>{n({type:"trashRequested",trashed:!0,relocate:a})},className:"pa0 fw6 no-underline gray hover-dark-gray bg-transparent bn pointer",children:"Undo"})]}),key:"trash"}),n({type:"updatedNotebook"}))}catch(c){n({type:"trashFailed"}),n({type:"showErrorToast",message:u?"Oops, trashing failed. Try again?":"Oops, moving out of trash failed. Try again?",key:"trash"})}},a=()=>({isUpdatingTrash:!0}),r=(e,t)=>{let{owner:n}=e,{trashed:s,relocate:i}=t;if(!s||!i)return{trashed:s,isUpdatingTrash:!1};location.replace((0,l.GN)(n))},c=()=>({isUpdatingTrash:!1})},4387:function(e,t,n){n.d(t,{$:function(){return o},W:function(){return l}});var s=n(602),i=n(27193);const o=async(e,t,n)=>{let{notebook:o}=e,{customThumbnail:l}=t;const{id:u,thumbnail:a}=o,r=(0,i.Ui)("model"in o?o.model:"title"in o?o:null);if((l||a!==o.defaultThumbnail)&&l!==a){n({type:"showProcessingToast",key:"thumbnail",message:"Setting thumbnail for ".concat(r,"\u2026")});try{const e=await(0,s.Fv)("/document/".concat(u,"/thumbnail"),{thumbnail:l||null});n({type:"showSuccessToast",key:"thumbnail",message:"Updated thumbnail"}),n({type:"setNotebookThumbnailSucceeded",customThumbnail:e}),n({type:"updatedNotebook"})}catch(c){return void n({type:"showErrorToast",message:"Oops, setting notebook thumbnail failed. Try again?",key:"thumbnail"})}}},l=(e,t)=>{let{defaultThumbnail:n}=e,{customThumbnail:s}=t;return{customThumbnail:s,thumbnail:s||n}}},810:function(e,t,n){n.d(t,{l:function(){return p}});var s=n(30169),i=n(4387),o=n(24205),l=n(21312),u=n(67220),a=n(61870),r=n(6826),c=n(41894),d=n(59533),h=n(16504);const p={collections:l.N5,descriptionUpdate:u.y,publishLiveRequested:a.kO,publishRequested:a.CU,publishSucceeded:o.dE,publishLiveSucceeded:o.dE,showModal:s.k,setNotebookThumbnail:i.$,setSlug:c.m,setSlugSucceeded:o.pf,share:r.B,transfer:d.r,trashRequested:h.fv,trashSucceeded:o.d$,unpublishRequested:a.rw,unpublishSucceeded:o.CL}},54937:function(e,t,n){n.d(t,{x:function(){return c}});var s=n(4387),i=n(17152),o=n(61870),l=n(6826),u=n(41894),a=n(59533),r=n(16504);const c={forkFailed:i.L3,forkPending:i.cL,publishRequested:o.iQ,publishSucceeded:o.au,publishFailed:o.gg,publishLiveSucceeded:o.r2,setNotebookThumbnailSucceeded:s.W,setSlugSucceeded:u.g,shareSucceeded:l.b,trashFailed:r.zu,trashRequested:r.pT,transferSucceeded:a.I,trashSucceeded:r.QJ,unpublishRequested:o.qc,unpublishSucceeded:o.dY,unpublishFailed:o.Kj}}}]);